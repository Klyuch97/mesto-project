(()=>{"use strict";var e={d:(t,o)=>{for(var n in o)e.o(o,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:o[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};function t(e){e.classList.add("popup_opened"),document.addEventListener("keydown",n),e.addEventListener("click",r)}function o(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",n),e.removeEventListener("click",r)}function n(e){if("Escape"===e.key){var t=document.querySelector(".popup_opened");t&&o(t)}}function r(e){e.target===e.currentTarget&&o(e.target)}e.d({},{F1:()=>w,kH:()=>I}),document.querySelector(".form__name-text"),document.querySelector("input:nth-of-type(2)"),document.querySelector(".profile__info-cell-text"),document.querySelector(".profile__info-text");var c={form:".form",formNameText:".form__name-text",formButton:".form__button",formNameTextTypeError:"form__name-text_type_error",formInputErrorActive:"form__input-error_active",formButtonDisabled:"form__button_disabled"},a=function(e,t,o){u(e,o)?(t.disabled=!0,t.classList.add(o.formButtonDisabled)):(t.disabled=!1,t.classList.remove(o.formButtonDisabled))},u=function(e,t){return e.some((function(e,t){return!e.validity.valid}))};function i(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}var l=document.querySelector(".popup_open-card"),d=l.querySelector(".popup__text-image"),s=l.querySelector(".popup__image"),m=document.querySelector(".form_add-image"),f=m.querySelector(".form_name-image"),p=m.querySelector("input:nth-of-type(2)"),y=document.querySelector(".elements"),_=document.querySelector(".popup_add_image");function v(e,o,n,r,c,a){var u=document.querySelector("#templateElements").content.cloneNode(!0),i=u.querySelector(".element__text"),m=u.querySelector(".element__image");i.textContent=e,m.src=o,m.alt=o;var f=u.querySelector(".element__likes-number"),p=u.querySelector(".element__button");0===c.length?f.textContent="0":f.textContent=c.length;for(var y=0;y<c.length;y++)c[y]._id===a&&p.classList.add("element__button_active");p.addEventListener("click",(function(e){var t;p.dataset.id=n,e.target.classList.toggle("element__button_active")?(t=p.dataset.id=n,fetch("https://nomoreparties.co/v1/plus-cohort-23/cards/likes/".concat(t),{method:"PUT",headers:{authorization:"70b0f800-c3d5-43c3-9a38-db0198e51959"}})).then((function(){e.target.nextElementSibling.textContent++})).catch((function(e){console.log(e)})):function(e){return fetch("https://nomoreparties.co/v1/plus-cohort-23/cards/likes/".concat(e),{method:"DELETE",headers:{authorization:"70b0f800-c3d5-43c3-9a38-db0198e51959"}})}(p.dataset.id=n).then((function(){e.target.nextElementSibling.textContent--})).catch((function(e){console.log(e)}))})),u.querySelector(".element__image").addEventListener("click",(function(e){e.preventDefault(),d.textContent=e.target.nextElementSibling.firstElementChild.textContent,s.src=e.target.src,s.alt=e.target.alt,t(l)}));var _=u.querySelector(".element__button-trash");return a!==r&&(_.style.display="none"),_.addEventListener("click",(function(){var e=_.closest(".element");e.dataset.id=n,function(e){return fetch("https://nomoreparties.co/v1/plus-cohort-23/cards/".concat(e),{method:"DELETE",headers:{authorization:"70b0f800-c3d5-43c3-9a38-db0198e51959"}})}(e.dataset.id).then((function(){e.remove()})).catch((function(e){console.log(e)}))})),u}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,n=new Array(t);o<t;o++)n[o]=e[o];return n}var S=document.querySelector(".profile__info-cell-button"),b=document.querySelector(".popup_edit-profile"),q=document.querySelector(".form__name-text"),g=document.querySelector("input:nth-of-type(2)"),x=document.querySelector(".profile__button"),E=document.querySelector(".popup_add_image"),L=document.querySelector(".form_add-image"),C=document.querySelector(".profile__info-cell-text"),k=document.querySelector(".profile__info-text"),T=document.querySelector(".form"),A=document.querySelector(".profile__edit-avatar-button"),j=document.querySelector(".popup_edit-avatar"),O=document.querySelector(".form_edit-avatar"),D=document.querySelector(".form_avatar"),N=document.querySelectorAll(".popup__close"),w=document.querySelector(".form__button__create"),z=document.querySelector(".form__button-edit-avatar"),P=(document.querySelector(".form__button"),document.querySelector(".form__button-edit-avatar"));function B(e,t){t.disabled=!0,t.classList.add(e.formButtonDisabled)}function I(e,t){e?t.textContent="Сохранение":(t.textContent="Сохранить",w.textContent="Создать")}S.addEventListener("click",(function(){t(b),q.value=C.textContent,g.value=k.textContent})),x.addEventListener("click",(function(){L.reset(),t(E),B(c,w)})),A.addEventListener("click",(function(){O.reset(),B(c,z),t(j)})),N.forEach((function(e){var t=e.closest(".popup");e.addEventListener("click",(function(){return o(t)}))})),L.addEventListener("submit",(function(e){var t;e.preventDefault(),I(!0,w),(t={name:f.value,link:p.value},fetch("https://nomoreparties.co/v1/plus-cohort-23/cards/",{method:"POST",headers:{authorization:"70b0f800-c3d5-43c3-9a38-db0198e51959","Content-Type":"application/json"},body:JSON.stringify({name:t.name,link:t.link})})).then((function(e){var t=v(f.value,p.value);y.prepend(t)})).catch((function(e){console.log(e)})).finally((function(){I(!1,w),o(_)}))})),O.addEventListener("submit",(function(e){var t;e.preventDefault(),I(!0,P),(t={avatar:D.value},fetch("https://nomoreparties.co/v1/plus-cohort-23/users/me/avatar",{method:"PATCH",headers:{authorization:"70b0f800-c3d5-43c3-9a38-db0198e51959","Content-Type":"application/json"},body:JSON.stringify({avatar:t.avatar})})).then((function(e){var t=document.querySelector(".profile__image"),n=D.value;t.src=n,o(j)})).catch((function(e){console.log(e)})).finally((function(){I(!1,P)}))})),function(e){Array.from(document.querySelectorAll(e.form)).forEach((function(t){!function(e,t){var o=Array.from(e.querySelectorAll(t.formNameText)),n=e.querySelector(t.formButton);a(o,n,t),o.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,o){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?function(e,t,o){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(o.formNameTextTypeError),n.classList.remove(o.formInputErrorActive),n.textContent=""}(e,t,o):function(e,t,o,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(n.formNameTextTypeError),r.textContent=o,r.classList.add(n.formInputErrorActive)}(e,t,t.validationMessage,o)}(e,r,t),a(o,n,t)}))}))}(t,e)}))}(c),Promise.all([fetch("https://nomoreparties.co/v1/plus-cohort-23/users/me",{headers:{authorization:"70b0f800-c3d5-43c3-9a38-db0198e51959"}}).then(i),fetch("https://nomoreparties.co/v1/plus-cohort-23/cards",{headers:{authorization:"70b0f800-c3d5-43c3-9a38-db0198e51959"}}).then(i)]).then((function(e){var t,o,n,r,c,a=(c=2,function(e){if(Array.isArray(e))return e}(r=e)||function(e,t){var o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var n,r,c,a,u=[],i=!0,l=!1;try{if(c=(o=o.call(e)).next,0===t){if(Object(o)!==o)return;i=!1}else for(;!(i=(n=c.call(o)).done)&&(u.push(n.value),u.length!==t);i=!0);}catch(e){l=!0,r=e}finally{try{if(!i&&null!=o.return&&(a=o.return(),Object(a)!==a))return}finally{if(l)throw r}}return u}}(r,c)||function(e,t){if(e){if("string"==typeof e)return h(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?h(e,t):void 0}}(r,c)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),u=a[0],i=a[1],l=u._id,d=u.about;t=u.avatar,o=u.name,n=d,document.querySelector(".profile__info-cell-text").textContent=o,document.querySelector(".profile__info-text").textContent=n,document.querySelector(".profile__image").src=t,i.forEach((function(e){var t=v(e.name,e.link,e._id,e.owner._id,e.likes,l);document.querySelector(".elements").append(t)}))})).catch((function(e){console.log(e)})),T.addEventListener("submit",(function(e){e.preventDefault();var t,n=document.querySelector(".popup_edit-profile"),r=document.querySelector(".form__button"),c=document.querySelector(".form__name-text"),a=document.querySelector("input:nth-of-type(2)"),u=document.querySelector(".profile__info-cell-text"),i=document.querySelector(".profile__info-text");I(!0,r),(t={name:c.value,about:a.value},fetch("https://nomoreparties.co/v1/plus-cohort-23/users/me",{method:"PATCH",headers:{authorization:"70b0f800-c3d5-43c3-9a38-db0198e51959","Content-Type":"application/json"},body:JSON.stringify({name:t.name,about:t.about})})).then((function(e){u.textContent=c.value,i.textContent=a.value,o(n)})).catch((function(e){console.log(e)})).finally((function(){I(!1,r)}))}))})();